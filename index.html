<!DOCTYPE html>
<html class="no-js">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0" />
        <title>youtube-player-timesync</title>
    </head>
    <body>
        <div id="player"></div>
        <div id="time"></div>
        <a href="#" id="click-handler" style="display: none;">Click on me! <span id="message"></span></a>
        <script>
            var EVENT = {
                start: 'start',
                stop: 'stop'
            };

            var AnEvent = function(type)
            {
                return {
                    type: type,
                    data: arguments[1]
                };
            }
            var data = {
                1234: new AnEvent(EVENT.start, 'hellos'),
                5678: new AnEvent(EVENT.stop),
                9101: new AnEvent(EVENT.start, 'yellows'),
                11213: new AnEvent(EVENT.stop)
            };
            var link = document.getElementById('click-handler');
            var message = document.getElementById('message');
            var time = document.getElementById('time');
            var interval;
            var player;

            function handleEvent(event)
            {
                switch (event.type)
                {
                    case EVENT.start:
                        link.style.display = 'block';

                        if (event.data)
                        {
                            message.innerHTML = event.data;
                        }

                    break;

                    case EVENT.stop:
                        link.style.display = 'none';

                    break;
                }
            }

            function handlePlayerInterval()
            {
                var hundredths = player.getCurrentTime() * 1000;
                var event;
                var mills;

                if (!Object.keys(data).length)
                {
                    clearInterval(interval);
                }

                for (mills in data)
                {
                    if (mills <= hundredths)
                    {
                        event = data[mills];

                        delete data[mills];
                    }
                }

                if (event)
                {
                    handleEvent(event);
                }

                time.innerHTML = player.getCurrentTime();
            }

            function onYouTubeIframeAPIReady()
            {
                player = new YT.Player('player', {
                    height: '390',
                    width: '640',
                    videoId: 'u1zgFlCw8Aw',
                    playerVars: {
                        controls: 0,
                        modestbranding: 1,
                        rel: 0,
                        showinfo: 0
                    },
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            }

            function onPlayerReady(event)
            {
                event.target.playVideo();
            }

            function onPlayerStateChange(event)
            {
                switch (event.data)
                {
                    case YT.PlayerState.PLAYING:
                        playerPlaying();

                    break;

                    case YT.PlayerState.PAUSED:
                    case YT.PlayerState.ENDED:
                        playerPaused();

                    break;
                }
            }

            function playerPaused()
            {
                clearInterval(interval);
            }

            function playerPlaying()
            {
                interval = setInterval(handlePlayerInterval, 100);
            }

            (function()
            {
                var tag = document.createElement('script');

                tag.src = "//www.youtube.com/iframe_api";
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            })();
        </script>
    </body>
</html>